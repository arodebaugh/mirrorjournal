{"ast":null,"code":"import _asyncToGenerator from \"/Users/andrewrodebaugh/Downloads/think-app-master/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\n// Todo: currently file system only works for iOS.\nimport { ChangeDetectorRef } from '@angular/core';\nimport { EmojiPickerComponent } from '../emoji-picker/emoji-picker.component';\nimport * as moment from 'moment';\nimport { ImageSettingsComponent } from '../image-settings/image-settings.component';\nimport * as CryptoJS from 'crypto-js';\nimport { PasswordDialogComponent } from '../password-dialog/password-dialog.component';\nimport { PopupEditorComponent } from '../popup-editor/popup-editor.component';\nimport { Directory, Encoding, Filesystem } from '@capacitor/filesystem';\nimport { Haptics, ImpactStyle, NotificationType } from '@capacitor/haptics';\nimport { JournalHelpComponent } from '../journal-help/journal-help.component';\nimport { Preferences } from '@capacitor/preferences';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@awesome-cordova-plugins/speech-recognition/ngx\";\nimport * as i2 from \"@ionic/angular\";\nimport * as i3 from \"@angular/router\";\nimport * as i4 from \"@awesome-cordova-plugins/image-picker/ngx\";\nimport * as i5 from \"@angular/platform-browser\";\nimport * as i6 from \"@angular/forms\";\nimport * as i7 from \"@awesome-cordova-plugins/native-storage/ngx\";\nimport * as i8 from \"@angular/common\";\n\nfunction JournalNewPage_ion_badge_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"ion-badge\", 12);\n    i0.ɵɵtext(1, \"!\");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction JournalNewPage_ion_button_8_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r9 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"ion-button\", 2);\n    i0.ɵɵlistener(\"click\", function JournalNewPage_ion_button_8_Template_ion_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r9);\n      const ctx_r8 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r8.saveJournalPrompt());\n    });\n    i0.ɵɵtext(1, \"Save\");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction JournalNewPage_ion_button_9_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r11 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"ion-button\", 2);\n    i0.ɵɵlistener(\"click\", function JournalNewPage_ion_button_9_Template_ion_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r11);\n      const ctx_r10 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r10.saveJournalPrompt());\n    });\n    i0.ɵɵtext(1, \"Saved\");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction JournalNewPage_ion_button_11_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r13 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"ion-button\", 13);\n    i0.ɵɵlistener(\"click\", function JournalNewPage_ion_button_11_Template_ion_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r13);\n      const ctx_r12 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r12.insertNewHeader());\n    });\n    i0.ɵɵelement(1, \"ion-icon\", 14);\n    i0.ɵɵtext(2, \" Insert optional header\");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction JournalNewPage_ion_card_12_img_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r18 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"img\", 21);\n    i0.ɵɵlistener(\"click\", function JournalNewPage_ion_card_12_img_1_Template_img_click_0_listener($event) {\n      i0.ɵɵrestoreView(_r18);\n      const ctx_r17 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r17.presentImageSettings($event));\n    });\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r14 = i0.ɵɵnextContext(2);\n    i0.ɵɵproperty(\"src\", ctx_r14.headerImageData, i0.ɵɵsanitizeUrl);\n  }\n}\n\nfunction JournalNewPage_ion_card_12_ion_icon_7_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r20 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"ion-icon\", 22);\n    i0.ɵɵlistener(\"click\", function JournalNewPage_ion_card_12_ion_icon_7_Template_ion_icon_click_0_listener() {\n      i0.ɵɵrestoreView(_r20);\n      const ctx_r19 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r19.clearMood());\n    });\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction JournalNewPage_ion_card_12_ion_icon_11_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r22 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"ion-icon\", 22);\n    i0.ɵɵlistener(\"click\", function JournalNewPage_ion_card_12_ion_icon_11_Template_ion_icon_click_0_listener() {\n      i0.ɵɵrestoreView(_r22);\n      const ctx_r21 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r21.clearActivity());\n    });\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction JournalNewPage_ion_card_12_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r24 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"ion-card\");\n    i0.ɵɵtemplate(1, JournalNewPage_ion_card_12_img_1_Template, 1, 1, \"img\", 15);\n    i0.ɵɵelementStart(2, \"ion-card-content\")(3, \"div\", 16)(4, \"ion-chip\", 17)(5, \"ion-label\", 2);\n    i0.ɵɵlistener(\"click\", function JournalNewPage_ion_card_12_Template_ion_label_click_5_listener() {\n      i0.ɵɵrestoreView(_r24);\n      const ctx_r23 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r23.presentEmojiModalMood());\n    });\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(7, JournalNewPage_ion_card_12_ion_icon_7_Template, 1, 0, \"ion-icon\", 18);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"ion-chip\", 17)(9, \"ion-label\", 2);\n    i0.ɵɵlistener(\"click\", function JournalNewPage_ion_card_12_Template_ion_label_click_9_listener() {\n      i0.ɵɵrestoreView(_r24);\n      const ctx_r25 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r25.presentEmojiModalActivity());\n    });\n    i0.ɵɵtext(10);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(11, JournalNewPage_ion_card_12_ion_icon_11_Template, 1, 0, \"ion-icon\", 18);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(12, \"ion-chip\", 17)(13, \"ion-label\", 2);\n    i0.ɵɵlistener(\"click\", function JournalNewPage_ion_card_12_Template_ion_label_click_13_listener() {\n      i0.ɵɵrestoreView(_r24);\n      const ctx_r26 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r26.setExpire());\n    });\n    i0.ɵɵtext(14);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(15, \"ion-chip\", 19);\n    i0.ɵɵlistener(\"click\", function JournalNewPage_ion_card_12_Template_ion_chip_click_15_listener() {\n      i0.ɵɵrestoreView(_r24);\n      const ctx_r27 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r27.changeLockState());\n    });\n    i0.ɵɵelementStart(16, \"ion-label\");\n    i0.ɵɵtext(17);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(18, \"ion-chip\", 19);\n    i0.ɵɵlistener(\"click\", function JournalNewPage_ion_card_12_Template_ion_chip_click_18_listener() {\n      i0.ɵɵrestoreView(_r24);\n      const ctx_r28 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r28.changeMemoriesState());\n    });\n    i0.ɵɵelementStart(19, \"ion-label\", 20);\n    i0.ɵɵtext(20);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(21, \"ion-chip\", 19);\n    i0.ɵɵlistener(\"click\", function JournalNewPage_ion_card_12_Template_ion_chip_click_21_listener() {\n      i0.ɵɵrestoreView(_r24);\n      const ctx_r29 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r29.speak());\n    });\n    i0.ɵɵelementStart(22, \"ion-label\");\n    i0.ɵɵtext(23, \"\\uD83C\\uDFA4 Speak (beta)\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(24, \"ion-chip\", 19);\n    i0.ɵɵlistener(\"click\", function JournalNewPage_ion_card_12_Template_ion_chip_click_24_listener($event) {\n      i0.ɵɵrestoreView(_r24);\n      const ctx_r30 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r30.help($event));\n    });\n    i0.ɵɵelementStart(25, \"ion-label\");\n    i0.ɵɵtext(26, \"\\uD83D\\uDCA1 Help\");\n    i0.ɵɵelementEnd()()()()();\n  }\n\n  if (rf & 2) {\n    const ctx_r4 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r4.headerImageData !== undefined || ctx_r4.headerImageData !== null);\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate1(\"\", ctx_r4.mood, \" Mood\");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r4.mood !== null);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\"\", ctx_r4.activity, \"\\uFE0F Activity\");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r4.activity !== null);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\"\\u231B \", ctx_r4.expireLabelText, \"\");\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(ctx_r4.lockState ? \"\\uD83D\\uDD12 Locked\" : \"\\uD83D\\uDD13 Unlocked\");\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(ctx_r4.memories ? \"\\uD83D\\uDC41 Show in memories\" : \"\\u26D4 Hide from memories\");\n  }\n}\n\nfunction JournalNewPage_ion_card_13_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r32 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"ion-card\")(1, \"ion-card-content\")(2, \"div\", 16)(3, \"h1\");\n    i0.ɵɵtext(4, \"Listening...\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"div\", 23);\n    i0.ɵɵelement(6, \"div\")(7, \"div\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(8, \"br\");\n    i0.ɵɵelementStart(9, \"ion-chip\", 19);\n    i0.ɵɵlistener(\"click\", function JournalNewPage_ion_card_13_Template_ion_chip_click_9_listener() {\n      i0.ɵɵrestoreView(_r32);\n      const ctx_r31 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r31.stopSpeak());\n    });\n    i0.ɵɵelementStart(10, \"ion-label\");\n    i0.ɵɵtext(11, \"\\uD83D\\uDED1 Stop\");\n    i0.ɵɵelementEnd()()()()();\n  }\n}\n\nfunction JournalNewPage_ion_text_16_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"ion-text\", 24);\n    i0.ɵɵtext(1, \"What are you thinking about?\");\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r6 = i0.ɵɵnextContext();\n    i0.ɵɵstyleProp(\"font-size\", ctx_r6.fontsize);\n  }\n}\n\nfunction JournalNewPage_div_17_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"div\", 25);\n  }\n\n  if (rf & 2) {\n    const ctx_r7 = i0.ɵɵnextContext();\n    i0.ɵɵstyleProp(\"font-size\", ctx_r7.fontsize);\n    i0.ɵɵproperty(\"innerHTML\", ctx_r7.journalContent, i0.ɵɵsanitizeHtml);\n  }\n}\n\nconst options = [['', '1', '2', '3', '4', '5', '6', '7', '8', '9', '10'], ['Never', 'Days', 'Weeks', 'Months', 'Years']];\nexport let JournalNewPage = /*#__PURE__*/(() => {\n  class JournalNewPage {\n    constructor(cdr, speechRecognition, navCtrl,\n    /*private taptic: TapticEngine,*/\n    platform, pickerController, popoverController, router, imagePicker, route, modalCtrl, sanitizer, fb, routerOutlet, alertController, toastController, modalController, nativeStorage) {\n      this.cdr = cdr;\n      this.speechRecognition = speechRecognition;\n      this.navCtrl = navCtrl;\n      this.platform = platform;\n      this.pickerController = pickerController;\n      this.popoverController = popoverController;\n      this.router = router;\n      this.imagePicker = imagePicker;\n      this.route = route;\n      this.modalCtrl = modalCtrl;\n      this.sanitizer = sanitizer;\n      this.fb = fb;\n      this.routerOutlet = routerOutlet;\n      this.alertController = alertController;\n      this.toastController = toastController;\n      this.modalController = modalController;\n      this.nativeStorage = nativeStorage;\n      this.journalName = 'New Journal Entry';\n      this.expireLabelText = 'Never';\n      this.mood = '😊';\n      this.activity = '✍️';\n      this.previouslySaved = false;\n      this.created = moment().format();\n      this.journalContent = '';\n      this.journalID = '';\n      this.headerImageData = '';\n      this.lockState = false;\n      this.modalUp = false;\n      this.memories = true;\n      this.speaking = false;\n      this.fontsize = 'default';\n      this.unsaved = true;\n      this.first = true;\n      this.autosave = false;\n      this.saveData = {\n        name: this.journalName,\n        locked: this.lockState,\n        date: this.created,\n        expire: this.expireLabelText,\n        mood: this.mood,\n        activity: this.activity,\n        headerImage: this.headerImageData,\n        content: this.journalContent,\n        id: this.journalID,\n        hideMemories: !this.memories\n      };\n\n      this.guid = () => {\n        const s4 = () => {\n          return Math.floor((1 + Math.random()) * 0x10000).toString(16).substring(1);\n        };\n\n        return s4() + s4() + '-' + s4() + '-' + s4() + '-' + s4() + '-' + s4() + s4() + s4();\n      };\n\n      this.route.queryParams.subscribe(params => {\n        if (this.router.getCurrentNavigation().extras.state) {\n          this.journalName = this.router.getCurrentNavigation().extras.state.journalName;\n          this.expireLabelText = this.router.getCurrentNavigation().extras.state.expireLabelText;\n          this.mood = this.router.getCurrentNavigation().extras.state.mood;\n          this.activity = this.router.getCurrentNavigation().extras.state.activity;\n          this.previouslySaved = true;\n          this.created = this.router.getCurrentNavigation().extras.state.created;\n          this.journalContent = this.router.getCurrentNavigation().extras.state.journalContent;\n          this.journalID = this.router.getCurrentNavigation().extras.state.journalID;\n          this.headerImageData = this.router.getCurrentNavigation().extras.state.headerImageData;\n          this.lockState = this.router.getCurrentNavigation().extras.state.lockState;\n\n          if (this.router.getCurrentNavigation().extras.state.passcode) {\n            this.passcode = this.router.getCurrentNavigation().extras.state.passcode;\n          }\n\n          this.newJournal = false;\n        } else {\n          this.newJournal = true;\n        }\n      });\n    }\n\n    ngOnInit() {}\n\n    ionViewDidEnter() {\n      var _this = this;\n\n      return _asyncToGenerator(function* () {\n        _this.modalUp = false;\n        _this.unsaved = true;\n        _this.first = true;\n        const tempFontsize = yield Preferences.get({\n          key: 'fontsize'\n        });\n\n        if (tempFontsize.value) {\n          _this.fontsize = tempFontsize.value;\n\n          if (_this.fontsize === 'default') {\n            _this.fontsize = '';\n          } else {\n            _this.fontsize = _this.fontsize + 'px';\n          }\n        }\n\n        const tempAutosave = yield Preferences.get({\n          key: 'autosave'\n        });\n\n        if (tempAutosave.value) {\n          _this.autosave = tempAutosave.value === 'true';\n        }\n      })();\n    }\n\n    stopSpeak() {\n      this.speechRecognition.stopListening().then(() => {\n        this.speaking = false;\n      }).catch(err => {\n        alert('error: ' + err);\n      });\n    }\n\n    speak() {\n      this.speechRecognition.isRecognitionAvailable().then(available => {\n        if (available) {\n          this.speechRecognition.hasPermission().then(hasPermission => {\n            if (!hasPermission) {\n              this.speechRecognition.requestPermission().then(() => console.log('Granted'), () => console.log('Denied'));\n            }\n\n            this.speaking = true;\n            this.speechRecognition.startListening({\n              prompt: 'Speech to text feature for creating journals.'\n            }).subscribe(matches => {\n              if (this.journalContent === '') {\n                this.journalContent = matches[0];\n              } else {\n                this.journalContent += '<br/><br/>' + matches[0];\n              }\n\n              this.cdr.detectChanges();\n              this.unsaved = true;\n              this.first = false;\n            }, err => {\n              this.speaking = false;\n              console.log(err);\n            });\n          });\n        } else {\n          alert('Speak Recognition is not available for this device ');\n        }\n      });\n    }\n\n    setExpire() {\n      var _this2 = this;\n\n      return _asyncToGenerator(function* () {\n        const picker = yield _this2.pickerController.create({\n          columns: _this2.getColumns(2, 11, options),\n          buttons: [{\n            text: 'Cancel',\n            role: 'cancel'\n          }, {\n            text: 'Confirm',\n            handler: value => {\n              // console.log(`Got Value ` + JSON.stringify(value));\n              if (value['col-1'].text === 'Never') {\n                Haptics.impact({\n                  style: ImpactStyle.Light\n                }); // this.taptic.selection();\n\n                _this2.expireLabelText = 'Never';\n              } else if (value['col-0'].text === '') {\n                Haptics.notification({\n                  type: NotificationType.Error\n                }); // this.taptic.notification({type: 'error'});\n\n                alert('Please set a number value!');\n              } else {\n                Haptics.impact({\n                  style: ImpactStyle.Light\n                }); // this.taptic.selection();\n\n                if (parseInt(value['col-0'].text) > 1) {\n                  _this2.expireLabelText = value['col-0'].text + ' ' + value['col-1'].text;\n                } else {\n                  _this2.expireLabelText = value['col-0'].text + ' ' + value['col-1'].text.slice(0, -1);\n                }\n              }\n\n              _this2.unsaved = true;\n              _this2.first = false;\n            }\n          }]\n        });\n        yield picker.present();\n      })();\n    }\n\n    getColumns(numColumns, numOptions, columnOptions) {\n      const columns = [];\n\n      for (let i = 0; i < numColumns; i++) {\n        columns.push({\n          name: `col-${i}`,\n          options: this.getColumnOptions(i, numOptions, columnOptions)\n        });\n      }\n\n      return columns;\n    }\n\n    getColumnOptions(columnIndex, numOptions, columnOptions) {\n      const op = [];\n\n      for (let i = 0; i < numOptions; i++) {\n        op.push({\n          text: columnOptions[columnIndex][i % numOptions],\n          value: i\n        });\n      }\n\n      return op;\n    }\n\n    writeToMasterDir(saveData, toast) {\n      var _this3 = this;\n\n      return _asyncToGenerator(function* () {\n        const contents = yield Filesystem.readFile({\n          path: 'Mirror-app/mirrorJournals.txt',\n          directory: Directory.Documents,\n          encoding: Encoding.UTF8\n        });\n\n        if (contents.data) {\n          // @ts-ignore\n          const newData = JSON.parse(contents.data);\n\n          if (!_this3.previouslySaved) {\n            newData.push({\n              id: _this3.journalID,\n              date: _this3.created\n            });\n          }\n\n          try {\n            const result = yield Filesystem.writeFile({\n              path: 'Mirror-app/mirrorJournals.txt',\n              data: JSON.stringify(newData),\n              directory: Directory.Documents,\n              encoding: Encoding.UTF8\n            });\n            toast.present();\n            _this3.unsaved = false;\n            _this3.first = false;\n            _this3.previouslySaved = true; // console.log('Wrote file', result);\n          } catch (e) {\n            console.error('Unable to write file', e);\n          }\n        } else {\n          const journals = [{\n            id: _this3.journalID,\n            date: _this3.created\n          }];\n\n          try {\n            const result = yield Filesystem.writeFile({\n              path: 'Mirror-app/mirrorJournals.txt',\n              data: JSON.stringify(journals),\n              directory: Directory.Documents,\n              encoding: Encoding.UTF8\n            });\n            Haptics.impact({\n              style: ImpactStyle.Light\n            }); // this.taptic.notification({type: 'success'});\n\n            toast.present();\n            _this3.unsaved = false;\n            _this3.first = false;\n            _this3.previouslySaved = true; // console.log('Wrote file', result);\n          } catch (e) {\n            console.error('Unable to write file', e);\n          }\n        }\n      })();\n    }\n\n    saveJournalToFile(saveData, toast) {\n      var _this4 = this;\n\n      return _asyncToGenerator(function* () {\n        if (_this4.journalID) {\n          const fileName = 'Mirror-app/' + _this4.journalID + '.txt';\n\n          try {\n            const result = yield Filesystem.writeFile({\n              path: fileName,\n              data: JSON.stringify(_this4.saveData),\n              directory: Directory.Documents,\n              encoding: Encoding.UTF8\n            }); // console.log('Wrote file', result);\n\n            Haptics.impact({\n              style: ImpactStyle.Light\n            }); // this.taptic.notification({type: 'success'});\n            // toast.present();\n\n            _this4.unsaved = false;\n            _this4.first = false;\n            _this4.previouslySaved = true;\n          } catch (e) {\n            alert('Unable to write file ' + JSON.stringify(e));\n          }\n        } else {\n          _this4.journalID = _this4.guid();\n          const fileName = 'Mirror-app/' + _this4.journalID + '.txt';\n\n          try {\n            const result = yield Filesystem.writeFile({\n              path: fileName,\n              data: JSON.stringify(_this4.saveData),\n              directory: Directory.Documents,\n              encoding: Encoding.UTF8\n            });\n\n            _this4.writeToMasterDir(saveData, toast);\n\n            console.log('Wrote file', result);\n          } catch (e) {\n            alert('Unable to write file ' + JSON.stringify(e));\n          }\n        }\n      })();\n    }\n\n    tryToEncrypt(saveData, toast) {\n      if (this.lockState) {\n        this.saveData.content = CryptoJS.AES.encrypt(this.saveData.content, this.passcode).toString();\n      }\n\n      this.saveJournalToFile(saveData, toast);\n    }\n\n    saveJournal() {\n      var _this5 = this;\n\n      return _asyncToGenerator(function* () {\n        const toast = yield _this5.toastController.create({\n          message: 'Your journal \\'' + _this5.journalName + '\\' has been saved!',\n          position: 'top',\n          color: 'primary',\n          duration: 2000,\n          buttons: [{\n            text: 'Dismiss',\n            role: 'cancel',\n            handler: () => {\n              console.log('Cancel clicked');\n            }\n          }]\n        });\n        _this5.saveData = {\n          name: _this5.journalName,\n          locked: _this5.lockState,\n          date: _this5.created,\n          expire: _this5.expireLabelText,\n          mood: _this5.mood,\n          activity: _this5.activity,\n          headerImage: _this5.headerImageData,\n          content: _this5.journalContent,\n          id: _this5.journalID,\n          hideMemories: !_this5.memories\n        };\n\n        try {\n          yield Filesystem.mkdir({\n            path: 'Mirror-app',\n            directory: Directory.Documents,\n            recursive: false // like mkdir -p\n\n          });\n\n          _this5.tryToEncrypt(_this5.saveData, toast);\n        } catch (e) {\n          _this5.tryToEncrypt(_this5.saveData, toast);\n\n          console.error('Unable to make directory', e);\n        }\n      })();\n    }\n\n    editName() {\n      var _this6 = this;\n\n      return _asyncToGenerator(function* () {\n        const past = _this6.previouslySaved;\n        _this6.previouslySaved = false;\n\n        _this6.saveJournalPrompt(past);\n      })();\n    }\n\n    saveJournalPrompt(past = false) {\n      var _this7 = this;\n\n      return _asyncToGenerator(function* () {\n        if (_this7.previouslySaved) {\n          _this7.saveJournal();\n        } else {\n          const alert = yield _this7.alertController.create({\n            header: 'Title',\n            inputs: [{\n              name: 'title',\n              type: 'text',\n              value: past ? _this7.journalName : '',\n              placeholder: 'Journal entry for ' + moment().format('MMMM Do, YYYY')\n            }],\n            buttons: [{\n              text: 'Cancel',\n              role: 'cancel',\n              cssClass: 'secondary',\n              handler: () => {\n                console.log('Confirm Cancel');\n              }\n            }, {\n              text: 'Ok',\n              handler: out => {\n                if (out.title.trim() === '') {\n                  _this7.journalName = 'Journal entry for ' + moment().format('MMMM Do, YYYY');\n                } else {\n                  _this7.journalName = out.title;\n                }\n\n                if (!_this7.previouslySaved) {\n                  _this7.created = moment().format();\n                }\n\n                _this7.saveJournal();\n              }\n            }]\n          });\n          yield alert.present();\n        }\n      })();\n    }\n\n    expandEditor() {\n      var _this8 = this;\n\n      return _asyncToGenerator(function* () {\n        // this.taptic.selection();\n        const modal = yield _this8.modalController.create({\n          component: PopupEditorComponent,\n          cssClass: 'modal-fullscreen',\n          componentProps: {\n            journalContent: _this8.journalContent\n          },\n          backdropDismiss: false\n        });\n        modal.onDidDismiss().then(dataReturned => {\n          if (dataReturned !== null) {\n            _this8.journalContent = dataReturned.data;\n\n            if (_this8.journalContent === '') {\n              _this8.modalUp = false;\n            } else {\n              _this8.unsaved = true;\n              _this8.first = false;\n\n              if (_this8.previouslySaved && _this8.autosave) {\n                _this8.saveJournalPrompt();\n              }\n            }\n          }\n        });\n        _this8.modalUp = true;\n        _this8.journalContent = '';\n        return yield modal.present();\n      })();\n    }\n\n    presentEmojiModalMood() {\n      var _this9 = this;\n\n      return _asyncToGenerator(function* () {\n        const modal = yield _this9.modalController.create({\n          component: EmojiPickerComponent,\n          componentProps: {\n            pickerName: 'Mood',\n            currentEmoji: _this9.mood\n          }\n        });\n        modal.onDidDismiss().then(dataReturned => {\n          if (dataReturned !== null) {\n            _this9.mood = dataReturned.data;\n            _this9.unsaved = true;\n            _this9.first = false;\n          }\n        });\n        return yield modal.present();\n      })();\n    }\n\n    presentEmojiModalActivity() {\n      var _this10 = this;\n\n      return _asyncToGenerator(function* () {\n        Haptics.impact({\n          style: ImpactStyle.Light\n        }); // this.taptic.selection();\n\n        const modal = yield _this10.modalController.create({\n          component: EmojiPickerComponent,\n          componentProps: {\n            pickerName: 'Activity',\n            currentEmoji: _this10.activity\n          }\n        });\n        modal.onDidDismiss().then(dataReturned => {\n          if (dataReturned !== null) {\n            _this10.activity = dataReturned.data;\n            _this10.unsaved = true;\n            _this10.first = false;\n          }\n        });\n        return yield modal.present();\n      })();\n    }\n\n    imageSelectorForHeader() {\n      this.imagePicker.getPictures({\n        maximumImagesCount: 1,\n        outputType: 1,\n        disable_popover: true\n      }).then(out => {\n        if (out.length === 1) {\n          if (out[0]) {\n            this.headerImageData = 'data:image/jpeg;base64,' + out[0];\n            this.unsaved = true;\n            this.first = false;\n          }\n        }\n      }).catch(err => {\n        alert('Error: ' + err);\n      });\n      Haptics.impact({\n        style: ImpactStyle.Light\n      }); // this.taptic.selection();\n    }\n\n    insertNewHeader() {\n      this.imagePicker.hasReadPermission().then(out => {\n        if (out) {\n          this.imageSelectorForHeader();\n        } else {\n          this.imagePicker.requestReadPermission().then(() => {\n            this.imageSelectorForHeader();\n          }).catch(err => {\n            alert('Error: ' + err);\n          });\n        }\n      });\n    }\n\n    presentImageSettings(ev) {\n      var _this11 = this;\n\n      return _asyncToGenerator(function* () {\n        const popover = yield _this11.popoverController.create({\n          component: ImageSettingsComponent,\n          event: ev,\n          translucent: true\n        });\n        popover.onDidDismiss().then(dataReturned => {\n          if (dataReturned.data === 'delete') {\n            _this11.headerImageData = null;\n          } else if (dataReturned.data === 'change') {\n            _this11.insertNewHeader();\n          }\n        });\n        return yield popover.present();\n      })();\n    }\n\n    help(ev) {\n      var _this12 = this;\n\n      return _asyncToGenerator(function* () {\n        const popover = yield _this12.popoverController.create({\n          component: JournalHelpComponent,\n          event: ev,\n          translucent: true\n        });\n        return yield popover.present();\n      })();\n    }\n\n    askForPasscode() {\n      var _this13 = this;\n\n      return _asyncToGenerator(function* () {\n        const alert = yield _this13.alertController.create({\n          message: 'What is your passcode?',\n          inputs: [{\n            name: 'passcode',\n            type: 'password',\n            placeholder: 'passcode',\n            attributes: {\n              inputmode: 'numeric',\n              pattern: '[0-9]*'\n            }\n          }],\n          buttons: [{\n            text: 'Cancel',\n            role: 'cancel',\n            cssClass: 'secondary',\n            handler: () => {\n              console.log('Confirm Cancel');\n              _this13.passcode = undefined;\n              _this13.lockState = false; // this.taptic.selection();\n            }\n          }, {\n            text: 'Ok',\n            handler: out => {\n              if (CryptoJS.AES.decrypt(_this13.passcode, out.passcode).toString(CryptoJS.enc.Utf8) === 'passcode') {\n                _this13.passcode = out.passcode; // this.taptic.notification({type: 'success'});\n              } else {\n                // this.taptic.notification({type: 'error'});\n                _this13.passcode = undefined;\n                _this13.lockState = false;\n\n                _this13.changeLockState();\n              }\n            }\n          }]\n        });\n        yield alert.present();\n      })();\n    }\n\n    openPasswordDialog() {\n      var _this14 = this;\n\n      return _asyncToGenerator(function* () {\n        const modal = yield _this14.modalController.create({\n          component: PasswordDialogComponent\n        });\n        modal.onDidDismiss().then(dataReturned => {\n          if (dataReturned !== null && dataReturned.data !== '') {\n            _this14.passcode = dataReturned.data;\n          } else {\n            _this14.lockState = false;\n          }\n\n          _this14.unsaved = true;\n          _this14.first = false;\n        });\n        return yield modal.present();\n      })();\n    }\n\n    changeLockState() {\n      var _this15 = this;\n\n      return _asyncToGenerator(function* () {\n        _this15.lockState = !_this15.lockState;\n\n        if (_this15.lockState && _this15.passcode === undefined) {\n          _this15.nativeStorage.getItem('passcode').then(out => {\n            _this15.passcode = out;\n\n            _this15.askForPasscode();\n          }).catch(err => {\n            console.log('Error getting passcode ' + err);\n\n            _this15.openPasswordDialog();\n          });\n        }\n      })();\n    }\n\n    changeMemoriesState() {\n      this.memories = !this.memories;\n      this.unsaved = true;\n      this.first = false;\n    }\n\n    clearMood() {\n      this.mood = null;\n      this.unsaved = true;\n      this.first = false;\n    }\n\n    clearActivity() {\n      this.activity = null;\n      this.unsaved = true;\n      this.first = false;\n    }\n\n    resetJournal() {\n      this.journalName = 'New Journal';\n      this.expireLabelText = 'Never';\n      this.mood = '😐';\n      this.activity = '✍️';\n      this.previouslySaved = false;\n      this.created = moment().format();\n      this.journalContent = '';\n      this.journalID = undefined;\n      this.headerImageData = undefined;\n      this.newJournal = undefined;\n      this.lockState = false;\n      this.passcode = undefined;\n      this.memories = true;\n      this.saveData = {\n        name: this.journalName,\n        locked: this.lockState,\n        date: this.created,\n        expire: this.expireLabelText,\n        mood: this.mood,\n        activity: this.activity,\n        headerImage: this.headerImageData,\n        content: this.journalContent,\n        id: this.journalID,\n        hideMemories: !this.memories\n      };\n    }\n\n    ionViewWillLeave() {\n      this.resetJournal();\n    }\n\n  }\n\n  JournalNewPage.ɵfac = function JournalNewPage_Factory(t) {\n    return new (t || JournalNewPage)(i0.ɵɵdirectiveInject(i0.ChangeDetectorRef), i0.ɵɵdirectiveInject(i1.SpeechRecognition), i0.ɵɵdirectiveInject(i2.NavController), i0.ɵɵdirectiveInject(i2.Platform), i0.ɵɵdirectiveInject(i2.PickerController), i0.ɵɵdirectiveInject(i2.PopoverController), i0.ɵɵdirectiveInject(i3.Router), i0.ɵɵdirectiveInject(i4.ImagePicker), i0.ɵɵdirectiveInject(i3.ActivatedRoute), i0.ɵɵdirectiveInject(i2.ModalController), i0.ɵɵdirectiveInject(i5.DomSanitizer), i0.ɵɵdirectiveInject(i6.UntypedFormBuilder), i0.ɵɵdirectiveInject(i2.IonRouterOutlet), i0.ɵɵdirectiveInject(i2.AlertController), i0.ɵɵdirectiveInject(i2.ToastController), i0.ɵɵdirectiveInject(i2.ModalController), i0.ɵɵdirectiveInject(i7.NativeStorage));\n  };\n\n  JournalNewPage.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: JournalNewPage,\n    selectors: [[\"app-journal-new\"]],\n    decls: 18,\n    vars: 9,\n    consts: [[\"slot\", \"start\"], [\"defaultHref\", \"/\", \"text\", \"Home\"], [3, \"click\"], [\"color\", \"danger\", 4, \"ngIf\"], [\"slot\", \"end\"], [3, \"click\", 4, \"ngIf\"], [\"class\", \"full-button\", \"expand\", \"full\", 3, \"click\", 4, \"ngIf\"], [4, \"ngIf\"], [\"id\", \"journal-display\"], [\"id\", \"editorExpand\", 3, \"click\"], [\"style\", \"margin-left: 10px; color: rgb(147, 152, 158)\", 3, \"font-size\", 4, \"ngIf\"], [\"style\", \"margin-left: 10px;\", 3, \"font-size\", \"innerHTML\", 4, \"ngIf\"], [\"color\", \"danger\"], [\"expand\", \"full\", 1, \"full-button\", 3, \"click\"], [\"name\", \"image-outline\", \"slot\", \"start\"], [3, \"src\", \"click\", 4, \"ngIf\"], [2, \"text-align\", \"center\"], [\"color\", \"primary\"], [\"name\", \"close-outline\", 3, \"click\", 4, \"ngIf\"], [\"color\", \"primary\", 3, \"click\"], [2, \"padding-right\", \"5px\"], [3, \"src\", \"click\"], [\"name\", \"close-outline\", 3, \"click\"], [1, \"lds-ripple\"], [2, \"margin-left\", \"10px\", \"color\", \"rgb(147, 152, 158)\"], [2, \"margin-left\", \"10px\", 3, \"innerHTML\"]],\n    template: function JournalNewPage_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"ion-header\")(1, \"ion-toolbar\")(2, \"ion-buttons\", 0);\n        i0.ɵɵelement(3, \"ion-back-button\", 1);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(4, \"ion-title\", 2);\n        i0.ɵɵlistener(\"click\", function JournalNewPage_Template_ion_title_click_4_listener() {\n          return ctx.editName();\n        });\n        i0.ɵɵtemplate(5, JournalNewPage_ion_badge_5_Template, 2, 0, \"ion-badge\", 3);\n        i0.ɵɵtext(6);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(7, \"ion-buttons\", 4);\n        i0.ɵɵtemplate(8, JournalNewPage_ion_button_8_Template, 2, 0, \"ion-button\", 5);\n        i0.ɵɵtemplate(9, JournalNewPage_ion_button_9_Template, 2, 0, \"ion-button\", 5);\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵelementStart(10, \"ion-content\");\n        i0.ɵɵtemplate(11, JournalNewPage_ion_button_11_Template, 3, 0, \"ion-button\", 6);\n        i0.ɵɵtemplate(12, JournalNewPage_ion_card_12_Template, 27, 8, \"ion-card\", 7);\n        i0.ɵɵtemplate(13, JournalNewPage_ion_card_13_Template, 12, 0, \"ion-card\", 7);\n        i0.ɵɵelementStart(14, \"div\", 8)(15, \"div\", 9);\n        i0.ɵɵlistener(\"click\", function JournalNewPage_Template_div_click_15_listener() {\n          return ctx.expandEditor();\n        });\n        i0.ɵɵtemplate(16, JournalNewPage_ion_text_16_Template, 2, 2, \"ion-text\", 10);\n        i0.ɵɵtemplate(17, JournalNewPage_div_17_Template, 1, 3, \"div\", 11);\n        i0.ɵɵelementEnd()()();\n      }\n\n      if (rf & 2) {\n        i0.ɵɵadvance(5);\n        i0.ɵɵproperty(\"ngIf\", ctx.unsaved && !ctx.first);\n        i0.ɵɵadvance(1);\n        i0.ɵɵtextInterpolate1(\" \", ctx.journalName, \"\");\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngIf\", ctx.unsaved);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", !ctx.unsaved);\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngIf\", ctx.headerImageData === undefined || ctx.headerImageData === null);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", !ctx.speaking);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.speaking);\n        i0.ɵɵadvance(3);\n        i0.ɵɵproperty(\"ngIf\", ctx.journalContent === \"\" && !ctx.modalUp);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.journalContent !== \"\" || ctx.modalUp);\n      }\n    },\n    dependencies: [i8.NgIf, i2.IonBackButton, i2.IonBadge, i2.IonButton, i2.IonButtons, i2.IonCard, i2.IonCardContent, i2.IonChip, i2.IonContent, i2.IonHeader, i2.IonIcon, i2.IonLabel, i2.IonText, i2.IonTitle, i2.IonToolbar, i2.IonBackButtonDelegate],\n    styles: [\".lds-ripple[_ngcontent-%COMP%]{display:inline-block;position:relative;width:80px;height:80px}.lds-ripple[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{position:absolute;border:4px solid #ff0000;opacity:1;border-radius:50%;animation:lds-ripple 1s cubic-bezier(0,.2,.8,1) infinite}.lds-ripple[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(2){animation-delay:-.5s}@keyframes lds-ripple{0%{top:36px;left:36px;width:0;height:0;opacity:1}to{top:0;left:0;width:72px;height:72px;opacity:0}}\"]\n  });\n  return JournalNewPage;\n})();","map":null,"metadata":{},"sourceType":"module"}