"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2648],{2648:(mt,v,u)=>{u.r(v),u.d(v,{JournalViewPageModule:()=>dt});var J=u(6895),C=u(433),s=u(8043),Z=u(7108),f=u(5861),N=u(5439),t=u(8274);function A(o,l){if(1&o){const e=t.EpF();t.TgZ(0,"ion-buttons",5)(1,"ion-button",1),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.save())}),t._uU(2,"Save"),t.qZA()()}}function P(o,l){if(1&o){const e=t.EpF();t.TgZ(0,"div",9),t.NdJ("click",function(){const a=t.CHM(e).index,c=t.oxw().index,_=t.oxw();return t.KtG(_.releasePressEvent(c,a))}),t.qZA()}if(2&o){const e=l.$implicit,n=t.oxw().$implicit;t.Q6J("innerHTML",n.highlight?"<span class='highlight'>"+e+" </span>":e+" ",t.oJD)}}function L(o,l){if(1&o){const e=t.EpF();t.TgZ(0,"div",10)(1,"ion-textarea",11),t.NdJ("ngModelChange",function(i){t.CHM(e);const a=t.oxw().$implicit;return t.KtG(a.note=i)}),t.qZA()()}if(2&o){const e=t.oxw().$implicit,n=t.oxw();t.xp6(1),t.Q6J("disabled",!n.newNote)("ngModel",e.note)("value",e.note)}}function M(o,l){if(1&o&&(t.TgZ(0,"div",6),t.YNc(1,P,1,1,"div",7),t.YNc(2,L,2,3,"div",8),t.qZA()),2&o){const e=l.$implicit;t.xp6(1),t.Q6J("ngForOf",e.text),t.xp6(1),t.Q6J("ngIf",e.highlight)}}let D=(()=>{class o{constructor(e,n,i){this.modalCtrl=e,this.alertController=n,this.toastController=i,this.data=[{text:"",highlight:!1,note:""}],this.noteData=[{text:[],highlight:!1,note:""}]}presentTip(){var e=this;return(0,f.Z)(function*(){e.toast=yield e.toastController.create({header:"\u{1f4a1} Tip",message:"Click on words to highlight them to take notes on your journal.",color:"warning",position:"bottom",buttons:[{text:"Close",role:"cancel",handler:()=>{console.log("Cancel clicked")}}]}),yield e.toast.present()})()}ngOnInit(){const e=["h1","h2","h3","h4","h5","h6","h7","i","strike","u","b","p","ul","li","ol","em","s","strong"];if(console.log(this.newNote),this.newNote){this.noteData=[];let n=this.data.content.replaceAll("<"," <").replaceAll(">","> ").split(" ");n=n.filter(c=>""!==c),console.log(JSON.stringify(n));const a=[];n.forEach((c,_)=>{if(c.includes("</")&&c.includes(">")){const r=c.replace("</","").replace(">","");console.log("end: "+JSON.stringify(a)),a.includes(r)&&(a.splice(a.indexOf(r),1),n[_]=c.replace("</"+r+">",""))}else if(c.includes("<")&&c.includes(">")){const r=c.replace("<","").replace(">","");e.includes(r)&&!a.includes(r)&&(a.push(r),n[_]=c.replace("<"+r+">",""))}for(const r in a)a[r].includes("h")?n[_]='<b class="'+a[r]+'">'+n[_]+"</b>":a[r].includes("li")?""!=n[_].replace(/\s+/g,"")&&(n[_]='<p class="'+a[r]+'">- '+n[_]+"</p>"):n[_]=a[r].includes("ul")||a[r].includes("ol")?n[_]:"<"+a[r]+">"+n[_]+"</"+a[r]+">"}),this.noteData=[{text:n,highlight:!1,note:""}],this.dataString=n}else this.noteData=this.data;this.presentTip()}dismiss(){var e=this;return(0,f.Z)(function*(){yield e.toast.dismiss(),yield e.modalCtrl.dismiss()})()}save(){var e=this;return(0,f.Z)(function*(){const n=yield e.alertController.create({header:"Title",inputs:[{name:"title",type:"text",placeholder:"My Note"}],buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary",handler:()=>{console.log("Confirm Cancel")}},{text:"Ok",handler:i=>{e.toast.dismiss(),e.pickerName=i.title;const a={name:e.pickerName,data:e.noteData,date:N().format("LLLL")};e.modalCtrl.dismiss(a)}}]});if(e.newNote)yield n.present();else{const i={name:e.pickerName,data:e.noteData,date:N().format("LLLL")};yield e.modalCtrl.dismiss(i)}})()}replaceAtIndex(e,n,i){const a=e;return a[n]=i,a}insertAtIndex(e,n,i){const a=e;return a.splice(n,0,i),a}insertBeforeIndex(e,n,i){return this.insertAtIndex(e,0===n?n:n-1,i)}insertAfterIndex(e,n,i){return this.insertAtIndex(e,n+1,i)}removeIndex(e,n){let i=[];0!==n&&(i=this.getLeftSide(e,n));const a=this.getRightSide(e,n);return i.concat(a)}getLeftSide(e,n){return e.slice(0,n)}getRightSide(e,n){return e.slice(n+1,e.length)}makeNewSplit(e,n,i=!1){const a=this.noteData[e].text[n],c=this.getLeftSide(this.noteData[e].text,n),_=this.getRightSide(this.noteData[e].text,n);this.noteData=this.replaceAtIndex(this.noteData,e,{text:[a],highlight:!0,note:""}),0===c.length?_.length>0&&(this.noteData=this.insertAfterIndex(this.noteData,e,{text:_,highlight:!1,note:""}),console.log("right: "+JSON.stringify(this.noteData))):(this.noteData=this.insertBeforeIndex(this.noteData,i?e+1:e,{text:c,highlight:!1,note:""}),_.length>0&&(this.noteData=this.insertAfterIndex(this.noteData,e+1,{text:_,highlight:!1,note:""})))}combineAtLeftIndex(e,n){this.noteData[e-1].text.push(this.noteData[e].text[n]),this.noteData[e].text=this.removeIndex(this.noteData[e].text,n)}combineAtRightIndex(e,n){this.noteData[e+1].text.unshift(this.noteData[e].text[n]),this.noteData[e].text=this.removeIndex(this.noteData[e].text,n)}combineAtBothIndex(e,n){let i=this.noteData[e-1].text.concat(this.noteData[e].text);i=i.concat(this.noteData[e+1].text),this.noteData=this.removeIndex(this.noteData,e+1),this.noteData=this.removeIndex(this.noteData,e),this.noteData[e-1].text=i}releasePressEvent(e,n){this.noteData[e].highlight?e>0?e+1===this.noteData.length?this.noteData[e-1].highlight||0!==n?this.noteData[e].highlight=!1:this.combineAtBothIndex(e,n):this.noteData[e-1].highlight||0!==n||this.noteData[e+1].highlight||n+1!==this.noteData[e].text.length?this.noteData[e-1].highlight||0!==n?this.noteData[e+1].highlight||n+1!==this.noteData[e].text.length?this.noteData[e].highlight=!1:this.combineAtRightIndex(e,n):this.combineAtLeftIndex(e,n):this.combineAtBothIndex(e,n):1===this.noteData.length||this.noteData[e+1].highlight||n+1!==this.noteData[e].text.length?this.noteData[e].highlight=!1:this.combineAtRightIndex(e,n):e>0?e+1===this.noteData.length?this.noteData[e-1].highlight&&0===n?this.combineAtLeftIndex(e,n):this.makeNewSplit(e,n,!0):this.noteData[e-1].highlight&&0===n&&this.noteData[e+1].highlight&&n+1===this.noteData[e].text.length?""===this.noteData[e-1].note&&""===this.noteData[e+1].note?this.combineAtBothIndex(e,n):""!==this.noteData[e-1].note&&""!==this.noteData[e+1].note?this.makeNewSplit(e,n):""!==this.noteData[e-1].note?this.combineAtRightIndex(e,n):this.combineAtLeftIndex(e,n):this.noteData[e-1].highlight&&0===n?this.combineAtLeftIndex(e,n):this.noteData[e+1].highlight&&n+1===this.noteData[e].text.length?this.combineAtRightIndex(e,n):this.makeNewSplit(e,n):1===this.noteData.length?this.makeNewSplit(e,n):this.noteData[e+1].highlight&&n+1===this.noteData[e].text.length?this.combineAtRightIndex(e,n):this.makeNewSplit(e,n),this.dataString=JSON.stringify(this.noteData)}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(s.IN),t.Y36(s.Br),t.Y36(s.yF))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-new-analyze"]],inputs:{pickerName:"pickerName",data:"data",newNote:"newNote"},decls:11,vars:3,consts:[["slot","start"],[3,"click"],["slot","end",4,"ngIf"],[1,"ion-padding"],["class","text-block",4,"ngFor","ngForOf"],["slot","end"],[1,"text-block"],["class","text-block",3,"innerHTML","click",4,"ngFor","ngForOf"],["class","note-textholder",4,"ngIf"],[1,"text-block",3,"innerHTML","click"],[1,"note-textholder"],["placeholder","Enter note here...","autoGrow","true","spellcheck","true",3,"disabled","ngModel","value","ngModelChange"]],template:function(e,n){1&e&&(t.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0)(3,"ion-button",1),t.NdJ("click",function(){return n.dismiss()}),t._uU(4,"Close"),t.qZA()(),t.TgZ(5,"ion-title"),t._uU(6),t.qZA(),t.YNc(7,A,3,0,"ion-buttons",2),t.qZA()(),t.TgZ(8,"ion-content",3)(9,"ion-text"),t.YNc(10,M,3,2,"div",4),t.qZA()()),2&e&&(t.xp6(6),t.Oqu(n.pickerName),t.xp6(1),t.Q6J("ngIf",n.newNote),t.xp6(3),t.Q6J("ngForOf",n.noteData))},dependencies:[J.sg,J.O5,s.YG,s.Sm,s.W2,s.Gu,s.yW,s.g2,s.wd,s.sr,s.j9,C.JJ,C.On],styles:["ion-textarea[_ngcontent-%COMP%]{border-left-color:#0d0d0d;border-left-style:solid;padding-left:5px}mark[_ngcontent-%COMP%]{background-color:#ff0!important;color:#000!important}mark[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{background-color:inherit!important;color:inherit!important}@media (prefers-color-scheme: dark){ion-textarea[_ngcontent-%COMP%]{border-left-color:gray}}.note-textholder[_ngcontent-%COMP%]{padding:10px!important}.text-block[_ngcontent-%COMP%]{display:inline}"]}),o})();var d=u(7206);function E(o,l){if(1&o){const e=t.EpF();t.TgZ(0,"div")(1,"ion-card")(2,"ion-card-content",3),t._uU(3," No notes... why don't you "),t.TgZ(4,"a",1),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.createANote())}),t._uU(5,"create one"),t.qZA(),t._uU(6,"? "),t.qZA()()()}}function F(o,l){if(1&o&&(t.TgZ(0,"h3"),t._uU(1),t.qZA()),2&o){const e=t.oxw().$implicit;t.xp6(1),t.Oqu(e.date)}}function S(o,l){if(1&o){const e=t.EpF();t.TgZ(0,"ion-item-sliding")(1,"ion-item",5),t.NdJ("click",function(){const a=t.CHM(e).$implicit,c=t.oxw(2);return t.KtG(c.openNote(a))}),t.TgZ(2,"ion-label")(3,"h2"),t._uU(4),t.qZA(),t.YNc(5,F,2,1,"h3",2),t.qZA()(),t.TgZ(6,"ion-item-options",6)(7,"ion-item-option",7),t.NdJ("click",function(){const a=t.CHM(e).$implicit,c=t.oxw(2);return t.KtG(c.trash(a))}),t._UZ(8,"ion-icon",8),t._uU(9," Delete"),t.qZA()()()}if(2&o){const e=l.$implicit;t.xp6(4),t.Oqu(e.name),t.xp6(1),t.Q6J("ngIf",void 0!==e.date)}}function V(o,l){if(1&o&&(t.TgZ(0,"ion-list"),t.YNc(1,S,10,2,"ion-item-sliding",4),t.qZA()),2&o){const e=t.oxw();t.xp6(1),t.Q6J("ngForOf",e.notes)}}let Y=(()=>{class o{constructor(e){this.modalController=e,this.notes=[]}ngOnInit(){}trash(e){var n=this;return(0,f.Z)(function*(){yield n.modalController.dismiss(e)})()}dismiss(){var e=this;return(0,f.Z)(function*(){yield e.modalController.dismiss()})()}createANote(){var e=this;return(0,f.Z)(function*(){yield e.modalController.dismiss(1)})()}openNote(e){var n=this;return(0,f.Z)(function*(){yield(yield n.modalController.create({component:D,componentProps:{pickerName:e.name,data:e.data,newNote:!1}})).present()})()}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(s.IN))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-notes-list"]],inputs:{notes:"notes"},decls:10,vars:2,consts:[["slot","start"],[3,"click"],[4,"ngIf"],[2,"text-align","center"],[4,"ngFor","ngForOf"],["detail","true",3,"click"],["side","end"],["color","danger",3,"click"],["name","trash-outline","slot","start"]],template:function(e,n){1&e&&(t.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0)(3,"ion-button",1),t.NdJ("click",function(){return n.dismiss()}),t._uU(4,"Close"),t.qZA()(),t.TgZ(5,"ion-title"),t._uU(6,"Notes"),t.qZA()()(),t.TgZ(7,"ion-content"),t.YNc(8,E,7,0,"div",2),t.YNc(9,V,2,1,"ion-list",2),t.qZA()),2&e&&(t.xp6(8),t.Q6J("ngIf",void 0===n.notes),t.xp6(1),t.Q6J("ngIf",n.notes.length>0))},dependencies:[J.sg,J.O5,s.YG,s.Sm,s.PM,s.FN,s.W2,s.Gu,s.gu,s.Ie,s.u8,s.IK,s.td,s.Q$,s.q_,s.wd,s.sr]}),o})();var T=u(1067),h=u(2610),w=u(5196),k=u(65),U=u(3323);function q(o,l){if(1&o&&t._UZ(0,"img",13),2&o){const e=t.oxw();t.Q6J("src",e.data.headerImage,t.LSH)}}function O(o,l){if(1&o&&(t.TgZ(0,"ion-chip",5)(1,"ion-label"),t._uU(2),t.qZA()()),2&o){const e=t.oxw();t.xp6(2),t.hij("",e.data.mood," Mood")}}function Q(o,l){if(1&o&&(t.TgZ(0,"ion-chip",5)(1,"ion-label"),t._uU(2),t.qZA()()),2&o){const e=t.oxw();t.xp6(2),t.hij("",e.data.activity," Activity")}}function H(o,l){if(1&o){const e=t.EpF();t.TgZ(0,"ion-label",14),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.viewNotes())}),t._uU(1),t.qZA()}if(2&o){const e=t.oxw();t.xp6(1),t.AsE("\u{1f50d} ",e.data.notes.length," ",e.data.notes.length>1?"notes":"note","")}}function G(o,l){if(1&o){const e=t.EpF();t.TgZ(0,"ion-label",14),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.viewNotes())}),t._uU(1,"\u{1f50d} 0 notes"),t.qZA()}}function z(o,l){if(1&o&&(t.TgZ(0,"ion-chip",15)(1,"ion-label"),t._uU(2),t.qZA()()),2&o){const e=t.oxw();t.xp6(2),t.hij("\u231b ",e.timeToExpire,"")}}function j(o,l){if(1&o){const e=t.EpF();t.TgZ(0,"ion-fab-button",14),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(2);return t.KtG(i.editJournal())}),t._UZ(1,"ion-icon",22),t.qZA()}}function K(o,l){if(1&o){const e=t.EpF();t.TgZ(0,"ion-fab-button",23),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(2);return t.KtG(i.editJournal())}),t._UZ(1,"ion-icon",22),t.qZA()}}function $(o,l){if(1&o){const e=t.EpF();t.TgZ(0,"ion-fab-button",14),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(2);return t.KtG(i.analyzeJournal())}),t._UZ(1,"ion-icon",24),t.qZA()}}function B(o,l){if(1&o){const e=t.EpF();t.TgZ(0,"ion-fab-button",25),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(2);return t.KtG(i.analyzeJournal())}),t._UZ(1,"ion-icon",24),t.qZA()}}function W(o,l){if(1&o){const e=t.EpF();t.TgZ(0,"ion-fab-button",14),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(2);return t.KtG(i.trashJournal())}),t._UZ(1,"ion-icon",26),t.qZA()}}function R(o,l){if(1&o){const e=t.EpF();t.TgZ(0,"ion-fab-button",27),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(2);return t.KtG(i.trashJournal())}),t._UZ(1,"ion-icon",26),t.qZA()}}function I(o,l){if(1&o&&(t.TgZ(0,"ion-fab",16)(1,"ion-fab-button"),t._UZ(2,"ion-icon",17),t.qZA(),t.TgZ(3,"ion-fab-list",18),t.YNc(4,j,2,0,"ion-fab-button",6),t.YNc(5,K,2,0,"ion-fab-button",19),t.YNc(6,$,2,0,"ion-fab-button",6),t.YNc(7,B,2,0,"ion-fab-button",20),t.YNc(8,W,2,0,"ion-fab-button",6),t.YNc(9,R,2,0,"ion-fab-button",21),t.qZA()()),2&o){const e=t.oxw();t.xp6(4),t.Q6J("ngIf",!e.menuLabel),t.xp6(1),t.Q6J("ngIf",e.menuLabel),t.xp6(1),t.Q6J("ngIf",!e.menuLabel),t.xp6(1),t.Q6J("ngIf",e.menuLabel),t.xp6(1),t.Q6J("ngIf",!e.menuLabel),t.xp6(1),t.Q6J("ngIf",e.menuLabel)}}function X(o,l){if(1&o){const e=t.EpF();t.TgZ(0,"ion-fab-button",14),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(2);return t.KtG(i.trashJournal())}),t._UZ(1,"ion-icon",26),t.qZA()}}function tt(o,l){if(1&o){const e=t.EpF();t.TgZ(0,"ion-fab-button",33),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(2);return t.KtG(i.trashJournal())}),t._UZ(1,"ion-icon",26),t.qZA()}}function et(o,l){if(1&o){const e=t.EpF();t.TgZ(0,"ion-fab-button",14),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(2);return t.KtG(i.analyzeJournal())}),t._UZ(1,"ion-icon",24),t.qZA()}}function nt(o,l){if(1&o){const e=t.EpF();t.TgZ(0,"ion-fab-button",34),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(2);return t.KtG(i.analyzeJournal())}),t._UZ(1,"ion-icon",24),t.qZA()}}function ot(o,l){if(1&o){const e=t.EpF();t.TgZ(0,"ion-fab-button",14),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(2);return t.KtG(i.editJournal())}),t._UZ(1,"ion-icon",22),t.qZA()}}function it(o,l){if(1&o){const e=t.EpF();t.TgZ(0,"ion-fab-button",23),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(2);return t.KtG(i.editJournal())}),t._UZ(1,"ion-icon",22),t.qZA()}}function at(o,l){if(1&o&&(t.TgZ(0,"ion-fab",28)(1,"ion-fab-button"),t._UZ(2,"ion-icon",17),t.qZA(),t.TgZ(3,"ion-fab-list",18),t.YNc(4,X,2,0,"ion-fab-button",6),t.YNc(5,tt,2,0,"ion-fab-button",29),t.qZA(),t.TgZ(6,"ion-fab-list",30),t.YNc(7,et,2,0,"ion-fab-button",6),t.YNc(8,nt,2,0,"ion-fab-button",31),t.qZA(),t.TgZ(9,"ion-fab-list",32),t.YNc(10,ot,2,0,"ion-fab-button",6),t.YNc(11,it,2,0,"ion-fab-button",19),t.qZA()()),2&o){const e=t.oxw();t.xp6(4),t.Q6J("ngIf",!e.menuLabel),t.xp6(1),t.Q6J("ngIf",e.menuLabel),t.xp6(2),t.Q6J("ngIf",!e.menuLabel),t.xp6(1),t.Q6J("ngIf",e.menuLabel),t.xp6(2),t.Q6J("ngIf",!e.menuLabel),t.xp6(1),t.Q6J("ngIf",e.menuLabel)}}function st(o,l){if(1&o){const e=t.EpF();t.TgZ(0,"ion-fab-button",14),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(2);return t.KtG(i.editJournal())}),t._UZ(1,"ion-icon",22),t.qZA()}}function lt(o,l){if(1&o){const e=t.EpF();t.TgZ(0,"ion-fab-button",38),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(2);return t.KtG(i.editJournal())}),t._UZ(1,"ion-icon",22),t.qZA()}}function rt(o,l){if(1&o){const e=t.EpF();t.TgZ(0,"ion-fab-button",14),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(2);return t.KtG(i.analyzeJournal())}),t._UZ(1,"ion-icon",24),t.qZA()}}function ct(o,l){if(1&o){const e=t.EpF();t.TgZ(0,"ion-fab-button",34),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(2);return t.KtG(i.analyzeJournal())}),t._UZ(1,"ion-icon",24),t.qZA()}}function _t(o,l){if(1&o){const e=t.EpF();t.TgZ(0,"ion-fab-button",14),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(2);return t.KtG(i.trashJournal())}),t._UZ(1,"ion-icon",26),t.qZA()}}function ut(o,l){if(1&o){const e=t.EpF();t.TgZ(0,"ion-fab-button",39),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(2);return t.KtG(i.trashJournal())}),t._UZ(1,"ion-icon",26),t.qZA()}}function ft(o,l){if(1&o&&(t.TgZ(0,"ion-fab",35)(1,"ion-fab-button"),t._UZ(2,"ion-icon",17),t.qZA(),t.TgZ(3,"ion-fab-list",18),t.YNc(4,st,2,0,"ion-fab-button",6),t.YNc(5,lt,2,0,"ion-fab-button",36),t.YNc(6,rt,2,0,"ion-fab-button",6),t.YNc(7,ct,2,0,"ion-fab-button",31),t.YNc(8,_t,2,0,"ion-fab-button",6),t.YNc(9,ut,2,0,"ion-fab-button",37),t.qZA()()),2&o){const e=t.oxw();t.xp6(4),t.Q6J("ngIf",!e.menuLabel),t.xp6(1),t.Q6J("ngIf",e.menuLabel),t.xp6(1),t.Q6J("ngIf",!e.menuLabel),t.xp6(1),t.Q6J("ngIf",e.menuLabel),t.xp6(1),t.Q6J("ngIf",!e.menuLabel),t.xp6(1),t.Q6J("ngIf",e.menuLabel)}}let ht=(()=>{class o{constructor(e,n,i,a,c,_,r,g,b){this.platform=e,this.modalController=n,this.alertController=i,this.routerOutlet=a,this.toastController=c,this.route=_,this.router=r,this.navCtrl=g,this.nativeStorage=b,this.menuLabel=!1,this.fabPos=1,this.route.queryParams.subscribe(y=>{this.router.getCurrentNavigation().extras.state?(this.data=this.router.getCurrentNavigation().extras.state.journal,this.router.getCurrentNavigation().extras.state.passcode&&(this.passcode=this.router.getCurrentNavigation().extras.state.passcode),"edit"===this.router.getCurrentNavigation().extras.state.action?this.editJournal():"delete"===this.router.getCurrentNavigation().extras.state.action?this.trashJournal():"create"===this.router.getCurrentNavigation().extras.state.action&&this.analyzeJournal(),this.dateFormatted=N(this.data.date).format("LLLL")):this.navCtrl.navigateBack("/")})}ngOnInit(){var e=this;return(0,f.Z)(function*(){const n=yield k.u.get({key:"menuLabel"});n.value&&(e.menuLabel="true"===n.value),e.platform.ready().then(()=>{window.matchMedia("(prefers-color-scheme: dark)").matches?w.N1.setStyle({style:w.vM.Dark}):w.N1.setStyle({style:w.vM.Light})})})()}ionViewWillLeave(){this.routerOutlet.swipeGesture=!0}ionViewDidEnter(){var e=this;return(0,f.Z)(function*(){const n=yield k.u.get({key:"menuplacement"});n.value&&(e.fabPos=parseInt(n.value));const i=e.data.expire.split(" "),a=N(e.data.date),c=N().diff(a,"hours");let _;"Days"===i[1]||"Day"===i[1]?_=24*i[0]:"Weeks"===i[1]||"Week"===i[1]?_=7*i[0]*24:"Months"===i[1]||"Month"===i[1]?_=30*i[0]*24:("Years"===i[1]||"Year"===i[1])&&(_=365*i[0]*24);let r=Math.round(_-c);if(r<0)alert("This should have been deleted?");else{e.timeToExpire="";const g=Math.floor(r/8760);r%=8760;const b=Math.floor(r/720);r%=720;const y=Math.floor(r/168);r%=168;const x=Math.floor(r/24);r%=24,g>1?e.timeToExpire+=g+" Years":1===g&&(e.timeToExpire+=g+" Year"),b>1?e.timeToExpire+=" "+g+" Months":1===b&&(e.timeToExpire+=" "+g+" Month"),y>1?e.timeToExpire+=" "+y+" Weeks":1===y&&(e.timeToExpire+=" "+y+" Week"),x>1?e.timeToExpire+=" "+x+" Days":1===x&&(e.timeToExpire+=" "+x+" Day"),r>1?e.timeToExpire+=" "+r+" Hours":1===r&&(e.timeToExpire+=" "+r+" Hour"),e.timeToExpire=e.timeToExpire.trim()}})()}deleteJournal(e){var n=this;return(0,f.Z)(function*(){const i=n.data;yield T.f.deleteFile({path:"Mirror-app/"+i.id+".txt",directory:p.Documents});const a=yield T.f.readFile({path:"Mirror-app/mirrorJournals.txt",directory:p.Documents,encoding:m.UTF8});let c=JSON.parse(a.data);c=c.filter(_=>_.id!==i.id);try{yield T.f.writeFile({path:"Mirror-app/mirrorJournals.txt",data:JSON.stringify(c),directory:p.Documents,encoding:m.UTF8}),yield k.u.set({key:"mirrorJournalListCache",value:JSON.stringify(c)});const _=yield T.f.readFile({path:"Mirror-app/mirrorJournalsCache.txt",directory:p.Documents,encoding:m.UTF8});let r=JSON.parse(_.data),g=r.filter(b=>JSON.parse(b.data).id!==i.id);g.length===r.length&&(g=r.filter(b=>JSON.parse(b.data).date!==i.date)),yield T.f.writeFile({path:"Mirror-app/mirrorJournalsCache.txt",data:JSON.stringify(g),directory:p.Documents,encoding:m.UTF8})}catch(_){console.error("Unable to write file",_)}h.ej.notification({type:h.k$.Success}),e.present(),n.navCtrl.navigateBack("/")})()}trashJournal(){var e=this;return(0,f.Z)(function*(){const n=yield e.toastController.create({message:"Your journal '"+e.data.name+"' has been deleted.",position:"top",color:"primary",duration:2e3,buttons:[{text:"Dismiss",role:"cancel",handler:()=>{}}]});yield(yield e.alertController.create({header:"\u{1f6a8} Are you sure? \u{1f6a8}",message:"This action cannot be reversed.",buttons:[{text:"Never mind",role:"cancel"},{text:"Delete",cssClass:"danger",handler:()=>{e.deleteJournal(n)}}]})).present()})()}askForPasscode(e){var n=this;return(0,f.Z)(function*(){yield(yield n.alertController.create({message:"What is your passcode?",inputs:[{name:"passcode",type:"password",placeholder:"passcode",attributes:{inputmode:"numeric",pattern:"[0-9]*"}}],buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary",handler:()=>{n.passcode=void 0,h.ej.impact({style:h.y$.Light})}},{text:"Ok",handler:a=>{"passcode"===d.AES.decrypt(n.passcode,a.passcode).toString(d.enc.Utf8)?(h.ej.impact({style:h.y$.Light}),n.passcode=a.passcode,e.present()):n.askForPasscode(e)}}]})).present()})()}saveNoteToFile(e,n){var i=this;return(0,f.Z)(function*(){const a="Mirror-app/"+i.data.id+".txt";try{yield T.f.writeFile({path:a,data:JSON.stringify(i.data),directory:p.Documents,encoding:m.UTF8}),n.present()}catch(c){console.error("Unable to write file",c)}i.data.content=d.AES.decrypt(i.data.content,i.passcode).toString(d.enc.Utf8),i.data.notes=JSON.parse(d.AES.decrypt(i.data.notes,i.passcode).toString(d.enc.Utf8))})()}tryToEncrypt(e,n){this.data.locked&&(this.data.content=d.AES.encrypt(this.data.content,this.passcode).toString(),this.data.notes=d.AES.encrypt(JSON.stringify(this.data.notes),this.passcode).toString()),this.saveNoteToFile(e,n)}analyzeJournal(){var e=this;return(0,f.Z)(function*(){const n=yield e.toastController.create({message:"Your note has been saved!",position:"top",color:"primary",duration:2e3,buttons:[{text:"Dismiss",role:"cancel",handler:()=>{}}]}),i=yield e.modalController.create({component:D,componentProps:{pickerName:"New Note",data:e.data,newNote:!0}});i.onDidDismiss().then(a=>{null!==a&&void 0!==a.data&&(e.data.notes?e.data.notes.push(a.data):e.data.notes=[a.data],e.data.notes=e.data.notes.filter(c=>c),e.tryToEncrypt(e.data,n))}),e.data.locked?e.nativeStorage.getItem("passcode").then(a=>{e.passcode=a,e.askForPasscode(i)}).catch(a=>{alert("Error getting passcode "+a)}):(h.ej.impact({style:h.y$.Light}),yield i.present())})()}viewNotes(){var e=this;return(0,f.Z)(function*(){const n=yield e.toastController.create({message:"Your note has been deleted!",position:"top",color:"primary",duration:2e3,buttons:[{text:"Dismiss",role:"cancel",handler:()=>{}}]});h.ej.impact({style:h.y$.Light});const i=yield e.modalController.create({component:Y,componentProps:{notes:e.data.notes}});i.onDidDismiss().then(a=>{null!==a&&void 0!==a.data?1===a.data?e.analyzeJournal():(e.data.notes=e.data.notes.filter(c=>c!==a.data),e.tryToEncrypt(e.data,n)):h.ej.impact({style:h.y$.Light})}),yield i.present()})()}editJournal(){let e;h.ej.impact({style:h.y$.Light}),e=this.passcode?{state:{journalName:this.data.name,expireLabelText:this.data.expire,mood:this.data.mood,activity:this.data.activity,created:this.data.date,journalContent:this.data.content,journalID:this.data.id,headerImageData:this.data.headerImage,lockState:this.data.locked,passcode:this.passcode}}:{state:{journalName:this.data.name,expireLabelText:this.data.expire,mood:this.data.mood,activity:this.data.activity,created:this.data.date,journalContent:this.data.content,journalID:this.data.id,headerImageData:this.data.headerImage,lockState:this.data.locked}},this.navCtrl.navigateForward("/journal-new",e)}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(s.t4),t.Y36(s.IN),t.Y36(s.Br),t.Y36(s.jP),t.Y36(s.yF),t.Y36(Z.gz),t.Y36(Z.F0),t.Y36(s.SH),t.Y36(U.k))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-journal-view"]],decls:29,vars:12,consts:[["slot","start"],["defaultHref","/","text","Home"],[3,"src",4,"ngIf"],[2,"text-align","center"],["color","primary",4,"ngIf"],["color","primary"],[3,"click",4,"ngIf"],["color","danger",4,"ngIf"],["id","journal-display",2,"margin-left","10pt","margin-right","10pt"],[3,"innerHTML"],["vertical","bottom","horizontal","start","slot","fixed","style","margin-bottom: 20pt; margin-left: 10pt;",4,"ngIf"],["vertical","bottom","horizontal","center","slot","fixed","style","margin-bottom: 20pt;",4,"ngIf"],["vertical","bottom","horizontal","end","slot","fixed","style","margin-bottom: 20pt; margin-right: 10pt;",4,"ngIf"],[3,"src"],[3,"click"],["color","danger"],["vertical","bottom","horizontal","start","slot","fixed",2,"margin-bottom","20pt","margin-left","10pt"],["name","cog"],["side","top"],["data-desc","Edit","class","desc-right",3,"click",4,"ngIf"],["data-desc","Note","class","desc-right",3,"click",4,"ngIf"],["data-desc","Delete","class","desc-right",3,"click",4,"ngIf"],["name","create-outline"],["data-desc","Edit",1,"desc-right",3,"click"],["name","search-outline"],["data-desc","Note",1,"desc-right",3,"click"],["name","trash"],["data-desc","Delete",1,"desc-right",3,"click"],["vertical","bottom","horizontal","center","slot","fixed",2,"margin-bottom","20pt"],["data-desc","Delete","class","desc-up",3,"click",4,"ngIf"],["side","start"],["data-desc","Note","class","desc-left",3,"click",4,"ngIf"],["side","end"],["data-desc","Delete",1,"desc-up",3,"click"],["data-desc","Note",1,"desc-left",3,"click"],["vertical","bottom","horizontal","end","slot","fixed",2,"margin-bottom","20pt","margin-right","10pt"],["data-desc","Edit","class","desc-left",3,"click",4,"ngIf"],["data-desc","Delete","class","desc-left",3,"click",4,"ngIf"],["data-desc","Edit",1,"desc-left",3,"click"],["data-desc","Delete",1,"desc-left",3,"click"]],template:function(e,n){1&e&&(t.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),t._UZ(3,"ion-back-button",1),t.qZA(),t.TgZ(4,"ion-title"),t._uU(5),t.qZA()()(),t.TgZ(6,"ion-content")(7,"ion-card"),t.YNc(8,q,1,1,"img",2),t.TgZ(9,"ion-card-header")(10,"ion-card-subtitle",3),t._uU(11),t.qZA()(),t.TgZ(12,"ion-card-content")(13,"div",3),t.YNc(14,O,3,1,"ion-chip",4),t.YNc(15,Q,3,1,"ion-chip",4),t.TgZ(16,"ion-chip",5),t.YNc(17,H,2,2,"ion-label",6),t.YNc(18,G,2,0,"ion-label",6),t.qZA(),t.YNc(19,z,3,1,"ion-chip",7),t.qZA()()(),t.TgZ(20,"div",8)(21,"ion-text"),t._UZ(22,"div",9)(23,"br")(24,"br")(25,"br"),t.qZA()(),t.YNc(26,I,10,6,"ion-fab",10),t.YNc(27,at,12,6,"ion-fab",11),t.YNc(28,ft,10,6,"ion-fab",12),t.qZA()),2&e&&(t.xp6(5),t.Oqu(n.data.name),t.xp6(3),t.Q6J("ngIf",void 0!==n.data.headerImage||null!==n.data.headerImage),t.xp6(3),t.Oqu(n.dateFormatted),t.xp6(3),t.Q6J("ngIf",null!==n.data.mood),t.xp6(1),t.Q6J("ngIf",null!==n.data.activity),t.xp6(2),t.Q6J("ngIf",void 0!==n.data.notes),t.xp6(1),t.Q6J("ngIf",void 0===n.data.notes),t.xp6(1),t.Q6J("ngIf","Never"!==n.data.expire),t.xp6(3),t.Q6J("innerHTML",n.data.content,t.oJD),t.xp6(4),t.Q6J("ngIf",0===n.fabPos),t.xp6(1),t.Q6J("ngIf",1===n.fabPos),t.xp6(1),t.Q6J("ngIf",2===n.fabPos))},dependencies:[J.O5,s.oU,s.Sm,s.PM,s.FN,s.Zi,s.tO,s.hM,s.W2,s.IJ,s.W4,s.zq,s.Gu,s.gu,s.Q$,s.yW,s.wd,s.sr,s.cs]}),o})();var p=(()=>{return(o=p||(p={})).Documents="DOCUMENTS",o.Data="DATA",o.Library="LIBRARY",o.Cache="CACHE",o.External="EXTERNAL",o.ExternalStorage="EXTERNAL_STORAGE",p;var o})(),m=(()=>{return(o=m||(m={})).UTF8="utf8",o.ASCII="ascii",o.UTF16="utf16",m;var o})();const gt=[{path:"",component:ht}];let pt=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[Z.Bz.forChild(gt),Z.Bz]}),o})(),dt=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[J.ez,C.u5,s.Pc,pt]}),o})()}}]);