<ion-content class="ion-padding-top" [fullscreen]="true">
  <br><br>
  <ion-list>
    <ion-item color="none" lines="none">
      <p>{{ todaysDate }}</p>
    </ion-item>
    <ion-item color="none" lines="none">
      <ion-title size="large">Journal</ion-title>
      <ion-buttons slot="end">
        <ion-button (click)="openPage('/tabs/journalNew')">
          <ion-icon name="add" size="large" color="dark"></ion-icon>
        </ion-button>
      </ion-buttons>
    </ion-item>
  </ion-list>

  <ion-grid>
    <ion-row class="ion-justify-content-around">
      <ion-col size="2"><ion-button fill="clear" color="dark" [id]="(currentPage === 'Home') ? 'selected-page' : ''" (click)="setSelectedPage('Home')">Home</ion-button></ion-col>
      <ion-col size="2"><ion-button fill="clear" color="dark" [id]="(currentPage === 'Search') ? 'selected-page' : ''" (click)="setSelectedPage('Search');resetFilteredJournal();">Search</ion-button></ion-col>
      <ion-col size="3"><ion-button fill="clear" color="dark" [id]="(currentPage === 'Memories') ? 'selected-page' : ''" (click)="setSelectedPage('Memories')">Memories <ion-badge *ngIf="memories.length > 0" style="margin-left: 4px;" color="danger">{{ memories.length }}</ion-badge></ion-button></ion-col>
      <ion-col size="3"><ion-button fill="clear" color="dark" [id]="(currentPage === 'Private') ? 'selected-page' : ''" (click)="setSelectedPage('Private')">Private</ion-button></ion-col>
    </ion-row>
  </ion-grid>

  <div *ngIf="currentPage === 'Home'">
    <div *ngIf="streakData.streak > 1">
      <ion-card style="margin-bottom: 0; margin-top: 8px;">
        <ion-card-content class="details-card">
          <ion-grid style="--ion-grid-padding: 0;">
            <ion-row class="ion-justify-content-around">
              <ion-col size="4">
                <p class="emoji">ðŸ”¥</p>
                <p>streak</p>
              </ion-col>
            </ion-row>
            <ion-row class="ion-justify-content-around">
              <ion-col size="4">
                <h1>{{ streakData.streak }}</h1>
              </ion-col>
            </ion-row>
          </ion-grid>
        </ion-card-content>
      </ion-card>
    </div>

    <ion-card *ngIf="!showJournals">
      <div style="text-align: center;"><img src="../assets/mirror-images/assembly 5.png" style="height: 300px; margin-top: 10px;"/></div>
      <ion-card-content style="text-align: center;">
        No entries... why don't you <a (click)="openPage('/tabs/journalNew')">express yourself</a>?
      </ion-card-content>
    </ion-card>

    <ion-grid>
      <ion-row>
        <ion-col sizeLg="6" sizeMd="6" sizeXs="12" *ngFor="let journal of journals; let i = index;">
          <ion-card style="margin-bottom: 0; margin-top: 8px;">
            <ion-card-header>
              <ion-grid style="--ion-grid-padding: 0;">
                <ion-row class="ion-justify-content-center">
                  <ion-col size="11" offset="0" style="--ion-grid-column-padding: 0;" (click)="openJournalPage('/tabs/journalView', journal)">
                    <ion-card-title>{{ journal.name }}</ion-card-title>
                  </ion-col>
                  <ion-col size="1" offset="0" style="--ion-grid-column-padding: 0;">
                    <ion-icon name="ellipsis-horizontal-outline" (click)="presentCardOptions($event, journal)"></ion-icon>
                  </ion-col>
                </ion-row>
              </ion-grid>
              <ion-card-subtitle (click)="openJournalPage('/tabs/journalView', journal)">{{ dateFormatted[i] }}</ion-card-subtitle>
              <ion-card-subtitle (click)="openJournalPage('/tabs/journalView', journal)" *ngIf="journal.locked"><ion-badge color="danger">Private</ion-badge></ion-card-subtitle>
            </ion-card-header>

            <ion-card-content (click)="openJournalPage('/tabs/journalView', journal)" [innerHTML]="journalContentFormatted[i] | words : 25">
            </ion-card-content>
          </ion-card>
        </ion-col>
      </ion-row>
    </ion-grid>

    <ion-infinite-scroll threshold="80px" (ionInfinite)="loadData($event)">
      <ion-infinite-scroll-content
              loadingSpinner="bubbles"
              loadingText="Loading more journal entries...">
      </ion-infinite-scroll-content>
    </ion-infinite-scroll>
    <br/><br/><br/><br/>
  </div>

  <div *ngIf="currentPage === 'Search'">
    <ion-grid>
      <ion-row>
        <ion-col><ion-searchbar #searchbar (ionInput)="search($event.target.value)"></ion-searchbar></ion-col>
      </ion-row>
    </ion-grid>

    <div *ngIf="filteredJournal.length > 0; else noResults">
      <ion-grid>
        <ion-row>
          <ion-col sizeLg="6" sizeMd="6" sizeXs="12" *ngFor="let journal of filteredJournal; let i = index;">
            <ion-card style="margin-bottom: 0; margin-top: 8px;">
              <ion-card-header>
                <ion-grid style="--ion-grid-padding: 0;">
                  <ion-row class="ion-justify-content-center">
                    <ion-col size="11" offset="0" style="--ion-grid-column-padding: 0;" (click)="openJournalPage('/tabs/journalView', journal)">
                      <ion-card-title>{{ journal.name }}</ion-card-title>
                    </ion-col>
                    <ion-col size="1" offset="0" style="--ion-grid-column-padding: 0;">
                      <ion-icon name="ellipsis-horizontal-outline" (click)="presentCardOptions($event, journal)"></ion-icon>
                    </ion-col>
                  </ion-row>
                </ion-grid>
                <ion-card-subtitle (click)="openJournalPage('/tabs/journalView', journal)">{{ journal.date }}</ion-card-subtitle>
                <ion-card-subtitle (click)="openJournalPage('/tabs/journalView', journal)" *ngIf="journal.locked"><ion-badge color="danger">Private</ion-badge></ion-card-subtitle>
              </ion-card-header>

              <ion-card-content (click)="openJournalPage('/tabs/journalView', journal)" [innerHTML]="journal.content | words : 25">
              </ion-card-content>
            </ion-card>
          </ion-col>
        </ion-row>
      </ion-grid>
    </div>

    <ng-template #noResults>
      <ion-card>
        <div style="text-align: center;"><img src="../assets/mirror-images/assembly 5.png" style="height: 300px; margin-top: 10px;"/></div>
        <ion-card-content style="text-align: center;">
          No search results
        </ion-card-content>
      </ion-card>
    </ng-template>

    <br/><br/><br/><br/>
  </div>

  <div *ngIf="currentPage === 'Memories'">
    <div *ngIf="memories.length > 0; else noMemories">
      <ion-card *ngFor="let journal of memories; let i = index;">
        <ion-card-header>
          <ion-row>
            <ion-col size="11" offset="0" style="--ion-grid-column-padding: 0;" (click)="openJournalPage('/tabs/journalView', journal)">
              <ion-card-title>{{ journal.name }}</ion-card-title>
            </ion-col>
            <ion-col size="1" offset="0" style="--ion-grid-column-padding: 0;">
              <ion-icon name="ellipsis-horizontal-outline" (click)="presentCardOptions($event, journal)"></ion-icon>
            </ion-col>
          </ion-row>
          <ion-card-subtitle (click)="openJournalPage('/tabs/journalView', journal)">{{ dateFormattedMemories[i] }}</ion-card-subtitle>
          <ion-card-subtitle *ngIf="journal.locked" (click)="openJournalPage('/tabs/journalView', journal)"><ion-badge color="danger">Private</ion-badge></ion-card-subtitle>
        </ion-card-header>

        <ion-card-content (click)="openJournalPage('/tabs/journalView', journal)" [innerHTML]="journalContentFormattedMemories[i] | words : 25">
        </ion-card-content>
      </ion-card>
    </div>
    
    <ng-template #noMemories>
      <ion-card>
        <div style="text-align: center;"><img src="../assets/mirror-images/assembly 5.png" style="height: 300px; margin-top: 10px;"/></div>
        <ion-card-content style="text-align: center;">
          No memories today!
        </ion-card-content>
      </ion-card>
    </ng-template>
  </div>

  <div *ngIf="currentPage === 'Private'">
    <ion-card  *ngIf="private.length === 0;">
      <div style="text-align: center;"><img src="../assets/mirror-images/assembly 5.png" style="height: 300px; margin-top: 10px;"/></div>
      <ion-card-content style="text-align: center;">
        No private journals yet!
      </ion-card-content>
    </ion-card>

    <div *ngIf="private.length > 0;">
      <ion-card *ngFor="let journal of private; let i = index;">
        <ion-card-header>
          <ion-row>
            <ion-col size="11" offset="0" style="--ion-grid-column-padding: 0;" (click)="openJournalPage('/tabs/journalView', journal)">
              <ion-card-title>{{ journal.name }}</ion-card-title>
            </ion-col>
            <ion-col size="1" offset="0" style="--ion-grid-column-padding: 0;">
              <ion-icon name="ellipsis-horizontal-outline" (click)="presentCardOptions($event, journal)"></ion-icon>
            </ion-col>
          </ion-row>
          <ion-card-subtitle (click)="openJournalPage('/tabs/journalView', journal)">{{ dateFormattedPrivates[i] }}</ion-card-subtitle>
        </ion-card-header>

        <ion-card-content (click)="openJournalPage('/tabs/journalView', journal)" [innerHTML]="journalContentFormattedPrivates[i] | words : 25">
        </ion-card-content>
      </ion-card>
    </div>

    <ion-infinite-scroll threshold="80px" (ionInfinite)="loadData($event)">
      <ion-infinite-scroll-content
              loadingSpinner="bubbles"
              loadingText="Loading more journal entries...">
      </ion-infinite-scroll-content>
    </ion-infinite-scroll>
    <br/><br/><br/><br/>
  </div>

  <!-- Menu button -->
  <ion-fab vertical="bottom" [horizontal]="fabPos === 0 ? 'start' : fabPos === 1 ? 'center' : 'end'" slot="fixed" [ngStyle]="{'margin-bottom': '20pt', 'margin-left': fabPos === 0 ? '10pt' : '0', 'margin-right': fabPos === 2 ? '10pt' : '0'}">
    <ion-fab-button>
      <ion-icon name="menu-outline"></ion-icon>
    </ion-fab-button>
    <ion-fab-list side="top">
      <app-fab-button [menuLabel]="menuLabel" icon="cog" (click)="openSettings()" desc="Settings" [class]="fabPos === 0 ? 'right' : fabPos === 2 ? 'left' : 'up'"></app-fab-button>
      <app-fab-button [menuLabel]="menuLabel" [icon]="lockIcon" (click)="unlockLockJournals()" [desc]="lockDesc" [class]="fabPos === 0 ? 'right' : fabPos === 2 ? 'left' : 'up'"></app-fab-button>
      <app-fab-button [menuLabel]="menuLabel" icon="add" (click)="openPage('/tabs/journalNew')" desc="New" [class]="fabPos === 0 ? 'right' : fabPos === 2 ? 'left' : 'up'"></app-fab-button>
    </ion-fab-list>
  </ion-fab>  
</ion-content>
